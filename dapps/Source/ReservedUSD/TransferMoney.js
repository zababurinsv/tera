
"public"
function TransferProcess(Params)
{
    if(context.FromNum!==context.Smart.Owner)
        throw "Error FromNum: "+context.FromNum+" need: "+context.Smart.Owner;
    var Format={Num:"uint",TotalSum:"double"};
    var Item=ReadValue("TransferTera",Format);
    if(!Item)
        Item={Num:-1,TotalSum:0};

    var AccMap=GetBalance();

    //check
    var TotalSum=0;
    for(var key in AccMap)
    {
        var Sum=AccMap[key];
        TotalSum+=Sum;
    }
    if(TotalSum!==14248305.699303)
        throw "Error TotalSum = "+TotalSum;


    Event("Start from="+Item.Num);

    var i=-1;
    var Count=0;
    var TotalSend=0;
    for(var key in AccMap)
    {
        i++;
        if(i>Item.Num)
        {
            Count++;
            if(Count>Params.Count)
                break;

            var Sum=AccMap[key];

            Item.Num=i;
            Event("Run: "+Item.Num+" Send: "+Sum);

            var TeraObj={Currency:0,PubKeyStr:key};
            AddCoin(TeraObj,COIN_FROM_FLOAT2(Sum));
            TotalSend+=Sum;
            Item.TotalSum+=Sum;

        }
    }


    WriteValue("TransferTera",Item,Format);
    Event("Send tx="+TotalSend);
    Event("Total  ="+Item.TotalSum);

}

function GetBalance()
{
    var TeraMap=
        {
            "0319E1446754980B1AEC2F6F81F9D03AC2F764240743948548ADAA95A72DAAAD0D": 2,
            "0361B3D8EB793F1C98CCA966BFC4DEC3F52241BE43E7DC6CD76301222630E269CD": 7.000001,
            "03D1A19C5139DD0A36A6DD2E72F42BD853CF8EE97F83D28533256FFC2AECB4E9A0": 10,
            "02B5627D54D0E08C228B83A250BE9C74AB81A28B6338E3B65214E9020EB45962DE": 12,
            "0245BF41627BC36C1820B5D216E06F5D98637978E1EF9311F257FF0955D882EE6E": 98.880001,
            "030F92C8B12A44CEFE850502DD58C548B13B063F64DAF67133F507F331CA02821C": 100,
            "02157B70159AE4B41CBBE6DC1FBEF8F58596D221E6EBB5DF695374BFE9E0EC24E8": 100,
            "03A14BEF55A44C7F0BA1AE894D1237409F7AF37655C3729662FEE515B736CA186B": 100,
            "0375AFBE6CEFD139A6C583898F66C045CD2EAF075C587934965E7D64F912DF1787": 100.000001,
            "032BD6D6C70F293E716055B5AF663713AF78013A537FA7433927CB5AE0B2783E97": 129.122705,
            "0261A5C9490F141795DAF766FD14B7F256A986F3703179486E62DE1223E2184220": 200,
            "028C686DC36B008E0E42CF0CE8887EBE6622375B56FB2AFE904763A3F88BD914FA": 200.608834,
            "03513617877368A0B25A4DB7CD0E245671F574A65E8CB0853C96DDE1D9D5FAFACB": 205.493457,
            "0270C9C0FBE6F58E7C0E749099249F32521968CDA28271F33700448CCA30054749": 427.570117,
            "03025DAC4CD53F749E3A6A9BD6137A4EF10FB7FA7DC0B9B49D1A7CF8D8961E9CCD": 812.7696960000321,
            "03ACA6882A3A2FA867EA82E8474377E3894BD90D9CDC6C3986E0809E30547326D3": 1256,
            "03E2DCBF0E9186F5AE62E6D4A0247F911F7731DBEC19E4670AE6D808BCC37FF084": 1460,
            "036E012848FF5789D1F780C82B1046AA35B4CF74666B76005804EC3D309A839B1C": 2000,
            "02A6AE60B16D1D7E7D9B01F015294305263670068CD39D83274557A28EB3A925C9": 3769,
            "027EF00F882C32E9CEF3F15D894E5AF834605C67056CBF447509268C29CE533489": 4812.906587,
            "03D08A990F7A57793CBD1347245AAAA0DB22740CCD5FECAF88AAAFD877B1F3C028": 4900,
            "02015CF959E88A38FE085866E928D1CE96547A3AB993E3AE70B94B91F1A2C200BF": 9999.309061,
            "0254583C2D9B1069FB6321D10732FFB8CFE3B2FE59394454BA776EE9AEC975EF5F": 10000,
            "02B52A902995C0CD970D52FCA283E4F17F9C09B1457994028A34E5CDF23A6ABF13": 10000,
            "0209C5104AA45410CF4A3B5FBAD40578384780E7776561A28DA7A1557466C877F5": 10000,
            "034FC99AF04743D3F248DD5C5A500C6F2610304979C4CCC5D0394B0CC76F1E69FC": 10005.262142,
            "0251ED6AC02F4D58937CE35E96FB8C798E1205E901AB231481D4849585DC78C541": 10775,
            "02B6D544C405E56D726FAAB5559C78CBDB25506520501D90A7343DA0C9CE563B50": 10824.95171200001,
            "02A2B1B254D7748A591D56DDAF7C466C2110F705D54CD635A8A51279A14C1C4D58": 15252,
            "02E2B3E1CCAE9FC1F6CBC5F9A839F0843B4372A2D33ED1530BB055DBAD3158C2B7": 20000,
            "02206AB39626ABB520F070AA2B95E4EB8C3235CD63B16B2421B2C5105D167EB6FE": 20000,
            "02675F5B756BDBB78008E44576BEC34B491E064FD869F0F432E10FFACB26A32CD9": 20000,
            "0200FD7B0B486AE4020C8BFB9C607396757CB66CF43B1276E7A175B57D65BEDEB3": 29312,
            "03BD5A447009EF3F9EB78859661C953004B760F0E941199397CEB61AA520392185": 32299,
            "035823B479B93FE5CE1884EAAC150DA9D5325E6E772B964550227CBDA70BED6040": 33555,
            "02B785B6C0E6CF17F06E076F17316325F05A97E46016DB13AB1ED1202918B480BF": 36000,
            "020BB32A0DB301E75F25A11E7EF22D09BCD234E8379175D5003103ED7CC947B500": 40000,
            "03C171F0A9F565E4E2579EAE98DC9FA0801A4C2AEC6610362C714E0858FC11F8AF": 40672.8,
            "03FBB3D919AB14E5384746FCD425552A5ECE6A7DAAA6147BC9748439C1C7F77A93": 40701.925641,
            "025543E84D4DD0C4536F9D643B91D9DAEBBA9A47EAB0F4B4AD664D8373942B7EF1": 47900,
            "0223CB711281F7CB6358B32CE39CD3A6EA763A31A80D9BEEB6DA17F67EC4C6E59E": 50000,
            "02D667A3A04D4F780674AEB94F46796C1689EB855B5FED355F65740EA26529D92B": 50000,
            "02CDC8254960D478265071FBE616647CAA39291FA35FD051EBFB8A617F41FCFDF1": 50677.047999999995,
            "02B7E2C421F2B0555F33D39C4E8005520B13DEB3433C8DDB0838BAA80BE2FE17AB": 54542.852513,
            "02A77ED80F265C969C52EBB4F4133A16B40D738CAD92E0E67CA50908C6710FD8E0": 61001,
            "02A3A5A3D684EEE90782CB3811493BA9236205552B14CFF789942EEAEBBE852378": 71581.964,
            "03E07EE582A44CBB647ECA5865B3F11F4D47CCE780B170D9B7851D3B647541C1A3": 76269,
            "03CEDE97C21A0FF9275A47BC290418CF44881FF7AB5DBC94B413A9EBF50D2C32BE": 85400.096459,
            "03647F1A993957707B82BA5D89764F7A99145960EAF92D44829EA8717403607D19": 87037.950326,
            "030B928A228C58956CA99D426C6BD2A84883A829163A38EB0E79B13CFEB767EDA6": 96575.26,
            "02DF134387797D27C78C239EBE82F76233E874BC0278EF906DB48CC897C1747254": 100000,
            "02F9BCC830886A9C55BD2761CC760BD6C22AD25C786270DD43CF38EB04561447E7": 113308.563489,
            "030FA9E47EDFF0FE5E278ED1F7663273F08A32C0766520C44BE38A895CA9094646": 118278.63692,
            "0277775863FC22FCF1CF71E47831C6FCD50245038976DFEFD3D6C80E52E1343B91": 121000,
            "02213E8603E17705ADA71988731C3A37F1959083A0F001EE58A1924F31B0F4683E": 123042.51999999999,
            "0331263DB8CA9EBF7DD93B9E923ABAD353ABDBC66C1CB9153B308205319DE30D3E": 124834.69188,
            "0388516FCF1D05777B21569171C4543B6558032377E6EF23D85FAA02B739893BB9": 141710.209799,
            "02BDC75BD9018786B194340733FD18ACA100D6B2FE9FB4279E489AAEC15F4BBB49": 194000,
            "039075E540D06F87CF3DF858E58E0147B4DBB922B498F55CF9477A5A4214DED775": 200001,
            "032EFEAF4A20883B2D0CF50D20F9A0702B21D9E662F6751A606B4D84D477D2F48E": 222378.146,
            "030041AEE13418692CA69C49A95ABBC725D4128DD4265869D6EB49CE355B25C6D5": 291475.112319,
            "023778490866C9EAC5E53CE89B933D01E0B3B03C531C8B28E61B1C848D345438D3": 300000,
            "029CB8BABB6CFE0E8F6935C3CD8A7F35B49E3B9529EA008C3EE4805268CFC2B3A3": 361557.82,
            "035FA528862A56832A862A92FF949FAC34F3570F2C9271DB520C1CBCA4EED395B1": 380500,
            "027CD7AD3B51F3F947DB19E2A3B675FDF65892EAF42DFDF868BF27B257EC998389": 400000,
            "03DE44D12E0CB5557069C22BAB93A8A78E9CB0679B1CC5F0D4A971E3CB17F409F6": 500000,
            "03010C84CD5057CF6DBA07D6201D63E20E04CA6468E4AF75BB1DDC2AA678DD6723": 500000,
            "02C5F358ED8FD67322A97EF5143E56775012A9FC2F893D83BBE262AE47C2FDBAD2": 564597.992279,
            "02D49A1FB0BDF2AEF8FCED74F85CF5BA1BC980AE6AC35DC1C54907DC28BF4C0B00": 925921.66,
            "0298B49A949355422FB900AB10DAEAFA1D26CD257826F8F066E951825C05851CF5": 1010605,
            "02F0259D80D3F817BC9829A8CAF85CC47536D9FE5AA7703BF1B043A0F2DF504EE4": 1025298.937873,
            "03DFA4EB734A7D1EAE5F7F3E242086CCAC5CA03BE621FF5E5A756B7127F9D0A523": 2064136.187527,
            "0292086CAE5CCCE53B0832525DEE05AFED025B62FE1E52B70796AFEC47AFFAF14E": 3314573.449964
        }

    return TeraMap;
}




//processing
function COIN_FROM_FLOAT2(Sum)
{
    var MAX_SUM_CENT = 1e9;
    var SumCOIN=Math.floor(Sum);
    var SumCENT = Math.floor(Sum * MAX_SUM_CENT - SumCOIN * MAX_SUM_CENT);
    var Coin={SumCOIN:SumCOIN,SumCENT:SumCENT};
    return Coin;
}


function GetKey(AccObj)
{
    return "AMOUNT:"+AccObj.PubKeyStr+":"+AccObj.Currency;
}



function GetFormatCoin()
{
    return {SumCOIN:"uint", SumCENT:"uint32", Flag:"uint", Freeze:{Sum:"double", Block:"uint32", Finish:"uint32"}};
}


function ReadCoin(AccObj)
{
    var KeyAmount=GetKey(AccObj);
    var AmountWas=ReadValue(KeyAmount,GetFormatCoin());
    if(!AmountWas)
    {
        AmountWas={SumCOIN:0, SumCENT:0,Flag:0,Freeze:{Sum:0, Block:0, Finish:0}};
        //if(AccObj.Currency===0) AmountWas.SumCOIN=100000;
    }

    return AmountWas;
}



function AddCoin(AccObj,Value)
{
    var KeyAmount=GetKey(AccObj);
    var AmountWas=ReadCoin(AccObj);
    ADD(AmountWas,Value);
    WriteValue(KeyAmount,AmountWas,GetFormatCoin());
}

